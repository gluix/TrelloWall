<html>
<head>
<!-- The client library requires jQuery  -->
  <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
  <script src="https://api.trello.com/1/client.js?key=3d8b8a5a1dbdc837c422f6dc12a0a6e8"></script>  
  <link rel="stylesheet" type="text/css" href="res/style.css">
  
  <script type='text/javascript'>//<![CDATA[ 
$(window).load(function(){

/* 
NOTE: The Trello client library has been included as a Managed Resource.  To include the client library in your own code, you would include jQuery and then

<script src="https://api.trello.com/1/client.js?key=your_application_key">...

See https://trello.com/docs for a list of available API URLs

The API development board is at https://trello.com/api

The &dummy=.js part of the managed resource URL is required per http://doc.jsfiddle.net/basic/introduction.html#add-resources
*/
$("#loggedout").toggle(true);
$("#loggedin").toggle(false);  

var onAuthorize = function() {
    updateLoggedIn();
    $("#output").empty();
    
    Trello.members.get("me", function(member){
        $("#fullName").text(member.fullName);
    

		var $boards = $("<div>")
            .text("Loading Boards...")		
            .appendTo("#output");
				
		Trello.get("organizations/orgname/boards", function(boards) {
            $boards.empty();
            $.each(boards, function(ix, board) {
				var renderBoard = 0;	
			
			    var $boardModule = $("<div>")                
                .addClass("window-module")
                .appendTo($boards);	
				$boardModule.hide();
								
				var $boardTitle = $("<div>")                
                .addClass("window-module-title")
                .appendTo($boardModule)
				
                var $boardLink = $("<a>")
                .attr({href: board.url, target: "trello", id: "board_" + board.id})
                .addClass("card")
                .text(board.name)
                .appendTo($boardTitle);	
				
				var $boardCards = $("<a>")                
                .addClass("gutter float-cards clearfix js-list")
                .appendTo($boardModule);
								
				Trello.get("/boards/" + board.id + "/lists", function(boardCards) {
					$boardCards.empty();
					$.each(boardCards, function(ix, list) {
						Trello.get("/lists/" + list.id + "/cards", function(boardCards) {
							$.each(boardCards, function(ix, card) {							
								for(i=0;i<card.labels.length;i++)
								{
									if(card.labels[i].name == "wall")
									{
										$boardModule.show();
										
										var $cardContainer = $("<div>")								
										.addClass("list-card-container")								
										.appendTo($boardCards);		
										
										var $card = $("<div>")								
										.addClass("list-card js-member-droppable clearfix assigned-to-timvengels ui-droppable")								
										.appendTo($cardContainer);	
										
										var $cardLabels = $("<div>")								
										.addClass("card-labels clearfix")								
										.appendTo($card);	
										
										var $cardLink = $("<a>")	
										.attr({href: card.url, target: "trello", id: "card_" + card.id})								
										.addClass("card-link")	
										.text(card.name)								
										.appendTo($cardLabels);
										
										var $cardList = $("<p>")								
										.addClass("list-card-position quiet")	
										.html("in <strong>" + list.name + "</strong>")								
										.appendTo($cardLabels);
									}
								}
							});  
						});						
					});  
				});
            });  
        });	
    });

};

var updateLoggedIn = function() {
    var isLoggedIn = Trello.authorized();
    $("#loggedout").toggle(!isLoggedIn);
    $("#loggedin").toggle(isLoggedIn);        
};
    
var logout = function() {
    Trello.deauthorize();
    updateLoggedIn();
};
                          
Trello.authorize({
    interactive:false,
    success: onAuthorize,
	name: "TrelloWall",
	expiration: "never",		
	persist: true
});

$("#connectLink")
.click(function(){
    Trello.authorize({
        type: "popup",
        success: onAuthorize,
		name: "TrelloWall",
		expiration: "never",		
		persist: true
    })
});
    
$("#disconnect").click(logout);
});//]]>  

</script>
</head>
<body class="page-index  chrome chrome-21 windows extra-large-window fixed-content wide-profile">


<div id="loggedin">
    <div id="header">
        Logged in as <span id="fullName"></span> 
        <a id="disconnect" href="#">Log Out</a>
    </div>
    
    <div id="output" class="js-cards-content"></div>
</div>  


<div id="loggedout">
    <a id="connectLink" href="#">Connect To Trello</a>
</div>
</body>
</html>